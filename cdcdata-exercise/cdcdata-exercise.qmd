---
title: "CDC Data Exercise"
format: html
editor: visual
---

# CDC Data Exercise

This dataset was sourced from the data repositories on the CDC website. This data evaluates the weekly hospitalization metrics for viral respiratory infections by jurisdiction in the United States from the mandatory reporting periods of August 1, 2020 to April 30, 2024, and then some voluntary reporting from May 1, 2024 - October 31, 2024. The data focuses on viral respiratory hospitalizations, primarily COVID-19 and influenza, and is derived from the National Healthcare Safety Network (NHSN).

The data is reported by week and contains information on the number of hospitals reporting adult COVID-19 adminssions, pediatric COVID-19 admissions, and influenza admissions. It then also provides a number of other variables related to hospital admissions and occupancies (including inpatient and ICU bed occupancies), and this is reported by geographic aggregation (State) and icludes the number of hospitals reporting in that time frame (including the hospital and patient reporting days).

The data can be found at this URL: <https://data.cdc.gov/Public-Health-Surveillance/Weekly-United-States-Hospitalization-Metrics-by-Ju/aemt-mg7g/about_data>

The citation for this data is:

Centers for Disease Control and Prevention, Division of Healthcare Quality Promotion, National Healthcare Safety Network (NHSN), Weekly United States Viral Respiratory Hospitalization, Bed Occupancy, and Bed Capacity Metrics by Jurisdiction, During the Mandatory Hospital Reporting Period from August 1, 2020 to April 30, 2024, and for Data Reported Voluntarily Beginning May 1, 2024 (version date: November 1, 2024).

## Evaluating the data

First let's load the required packages for our data analysis

```{r}
library(tidyverse)
library(dplyr)
library("readr")
library(ggplot2)
library(patchwork)

```

Let us load and get a summary of the CDC dataset. Note that the name of the file was changed at download to have a more user friendly name. Change the name at download to the same name used below or change the name of the file when loading the data to the name We will name this full dataset as cdc_datsset in R and work with that variable name.

```{r}
cdc_dataset <- read_csv("cdc_data_weekly_respiratory_hospitalizations_2020-2024.csv")

#Viewing the dataset and getting a summary
summary(cdc_dataset)
view(cdc_dataset)
print(cdc_dataset)
```

The summary of the dataset is valuable but it helps to actually view and scroll through the data for a better overview and feel of the data.

We can see that this is a very large dataset. There are 12597 observations in this dataset and 82 columns. We have to do a lot of scrolling to see much, including our summary, which is not very helpful. This is very big for us to evaluate and so we might want to cut it down a bit before we spend time filtering through and cleaning all of the data that is not of interest to us.

For this evaluation we want to have an idea of how COVID-19 and infuenza affected the population by evaluating the hospitilization rates. We are interested in knowing how this affected the healthcare system so we will include the information related to how many hospitals reported data and the occupancy of these hospitals. From viewing the data there seems to be overlap and repetition of some of the data, as well as categories and definitions that are not necessary for us, so we will reduce our columns to those of greatest interest to us. We will focus on adult data as the reporting of pediatric data seems to be limited to COVID-19 and thus will limit any comparisons to influenza.

We are also not going to split up ICU vs general admissions for our evaluations, but this is somehting that could be broken down.

We will also cut down our observations by focusing on one State and by defining our time frame.

This part could be done in either order and the State and time frame could be adapted.

Cutting down our dataset: Since we know that the mandatory reporting period will have the best information reported, we will focus on this time frame August 1, 2020 - April 30, 2024. We will also start by focusing on the state of Georgia (region=GA). We will use the filter function to get the rows with these variables.

```{r}
#Using the filter function to select for our rows of interest. We will assign these to two new variables.
#Filter by State = selecting GA
cdc_data_georgia <- cdc_dataset |> filter(`Geographic aggregation` == "GA")

#Filter further by date = August 1, 2020 - April 30, 2024
cdc_georgia_mandatory_data <- cdc_data_georgia |> filter(`Week Ending Date`>="2020-08-01" & `Week Ending Date` <= "2024-04-30")

```

We can see that we have filtered our observations down to 195 observations. We could do the same thing for multiple states (or have included multiple states) and compared the data between states.

Now we will focus on selecting the columns that we are most interested in: We will use the select function. Columns of interest to be kept: - Week Ending Date - Geographic aggregation - Number Hospitals Reporting Adult COVID-19 Admissions - Number Hospitals Reporting Influenza Admissions - Weekly Total Adult COVID-19 Admissions - Weekly Total Influenza Admissions - Weekly Average Hospitalized COVID-19 ICU Patients - Weekly Average Hospitalized Influenza ICU Patients - Weekly Average Inpatient Beds - Weekly Average ICU Beds - Weekly Average Inpatient Beds Occupied - Weekly Average ICU Beds Occupied

Defining our new dataset with columns of interest:

```{r}
#Using the select function to define our columns of interest for the GA dataset that we refined
cdc_ga_mandatory_refined <- cdc_georgia_mandatory_data |> select(`Week Ending Date`,
`Geographic aggregation`,
`Number Hospitals Reporting Adult COVID-19 Admissions`,
`Number Hospitals Reporting Influenza Admissions`,
`Weekly Total Adult COVID-19 Admissions`,
`Weekly Total Influenza Admissions`,
`Weekly Average Hospitalized COVID-19 ICU Patients`,
`Weekly Average Hospitalized Influenza ICU Patients`,
`Weekly Average Inpatient Beds`,
`Weekly Average ICU Beds`,
`Weekly Average Inpatient Beds Occupied`,
`Weekly Average ICU Beds Occupied`)

#View the new datset and a summary
summary(cdc_ga_mandatory_refined)
view(cdc_ga_mandatory_refined)
print(cdc_ga_mandatory_refined)
  
```

We have reduced our datset to a much more manageable set of information that we can refine and evalaute. If we feel that we should incude an additional column (left something valuable out) we can go back and add it now. Our sumamry shows us that we have a few NA values in our datset.

We will look for these using the is.na function. We will create a specific variable from these NA values to make it easier to visualise without searching. In reality, with the summary and reduced size of the dataset we can scroll through and find these if we want. However, printing these specifically allows us to isolate them quickly.

```{r}
cdc_refined_ga_NA <- cdc_ga_mandatory_refined |> filter(if_any(everything(), is.na))

print(cdc_refined_ga_NA)
```

We can see that these NA values are in the first four weeks of observations, and one week in October 2020, and that they are all in the influenza observations. We might be led to believe that perhaps the recording/reporting (or testing) of influenza tests was halted in the peak of the COVID-19 pandemic when resources were limited, or that the order to report influenza cases for this use only cae through later. This is somehtign that we might be able to find on the CDC website if desired. We will not delete these observations because we would lose valuable information related to the COVID-19 pandemic from these weeks. We could potentially use synthetic data for these missing variables or we could work on date ranges that do not include these weeks (2020-08-08 - 2020-08-29 and 2020-10-10) if we want to compare COVID-19 to Influenza.

We will make a few plots of different variables. We will start by analyzing the COVID-19 data.

```{r}
#We are looking at the distribution of the total adult COVID-19 cases  
covid_adult_admissions_plot<- ggplot(cdc_ga_mandatory_refined, aes(x=`Weekly Total Adult COVID-19 Admissions`)) + geom_histogram(bins=10,fill= "green", color = "black") + labs(title = "Distribution of the weekly total adult COVID-19 Hospital Admissions", x = "Weekly Total Adult COVID-19 Admissions", y = "Week counts")

print(covid_adult_admissions_plot)

```

We will get a summmary of this data (Distribution of the weekly total adult COVID-19 Hospital Admissions) and calcualte the standard deviation

```{r}
summary(cdc_ga_mandatory_refined$`Weekly Total Adult COVID-19 Admissions`)
#We will calculate the standard deviation
sd(cdc_ga_mandatory_refined$`Weekly Total Adult COVID-19 Admissions`)
```

```{r}
#We are looking at the distribution of the average hospitalized COVID-19 ICU patients  
covid_icu_patients_plot<- ggplot(cdc_ga_mandatory_refined, aes(x=`Weekly Average Hospitalized COVID-19 ICU Patients`)) + geom_histogram(bins=10,fill= "red", color = "black") + labs(title = "Distribution of the average COVID-19 Hospital ICU Patients", x = "Weekly Average COVID-19 ICU Patients", y = "Week counts")

print(covid_icu_patients_plot)

```

We will get a summmary of this data (Distribution of the average COVID-19 Hospital ICU Patients) and calcualte the standard deviation

```{r}
summary(cdc_ga_mandatory_refined$`Weekly Average Hospitalized COVID-19 ICU Patients`)
#We will calculate the standard deviation
sd(cdc_ga_mandatory_refined$`Weekly Average Hospitalized COVID-19 ICU Patients`)
```

We see how many more patients were hospitalized than were in ICU in Georgia, as the max number for the ICU patients is quite close to mean value of the hospital admissions.

Looking at the same distributions for the Influenza data:

```{r}
#We are looking at the distribution of the total Influenza cases  
influenza_adult_admissions_plot<- ggplot(cdc_ga_mandatory_refined, aes(x=`Weekly Total Influenza Admissions`)) + geom_histogram(bins=10,fill= "blue", color = "black") + labs(title = "Distribution of the weekly Influenza Hospital Admissions", x = "Weekly Total Influenza Admissions", y = "Week counts")

print(influenza_adult_admissions_plot)

```

We receive a warning that some values were excluded (likely our NA values).

We will get a summmary of this data (Weekly Total Influenza Admissions) and calcualte the standard deviation.

```{r}
summary(cdc_ga_mandatory_refined$`Weekly Total Influenza Admissions`)
#We will calculate the standard deviation and exclude the NA values in the influenza data
sd(cdc_ga_mandatory_refined$`Weekly Total Influenza Admissions`, na.rm = TRUE)  
```

The mean value for admissions for the influenza cases is a great deal lower than that from the COVID-19 cases. We see that the mean of the COVID-19 hospital admissions is 17.2 times greater than the mean from the influenza admissions.

```{r}
#We are looking at the distribution of the average influenza ICU patients  
influenza_icu_patients_plot<- ggplot(cdc_ga_mandatory_refined, aes(x=`Weekly Average Hospitalized Influenza ICU Patients`)) + geom_histogram(bins=10,fill= "red", color = "black") + labs(title = "Distribution of the average Influenza Hospital ICU Patients", x = "Weekly Average Influenza ICU Patients", y = "Week counts")

print(influenza_icu_patients_plot)

```

We get the same warning as our previous plot for the influenza cases (regarding the missing NA values).

We will get a summmary of this data (Weekly Average Influenza ICU Patients) and calcualte the standard deviation.

```{r}
summary(cdc_ga_mandatory_refined$`Weekly Average Hospitalized Influenza ICU Patients`)
#We will calculate the standard deviation and exclude the NA values in the influenza data
sd(cdc_ga_mandatory_refined$`Weekly Average Hospitalized Influenza ICU Patients`, na.rm = TRUE)
```

The mean value for ICU patients for the influenza cases is also much lower than that from the COVID-19 cases (not quite as much compared to admissions). We see that the mean of the COVID-19 hospital admissions is 6.2 times greater than the mean from the influenza ICU patients.

By comparing the plots and summary data we generated for COVID-19 and Influenza cases we can already see the much greater number of hospital admissions and ICU cases from COVID-19 compared to influenza. We also see the wider range for the COVID-19 cases compared to Influenza. The pronounced impact of COVID-19 as a respiratory disease is obvious before we do further analysis.

We can evaluate the strain on the healthcare system by looking at the hospital beds that were occupied (we will just look at total numbers between inpatient and ICU and not as a percentage). This does not distinguish what caused the beds to be occupied.

Looking at the distributions of occupied inptient beds:

```{r}
#We are looking at the distribution of the occupied inptient beds  
cdc_inpatient_occupied_beds_plot<- ggplot(cdc_ga_mandatory_refined, aes(x=`Weekly Average Inpatient Beds Occupied`)) + geom_histogram(bins=10,fill= "blue", color = "black") + labs(title = "Distribution of the weekly Average Occupied Inpatient Beds", x = "Weekly Inpatient Beds", y = "Week counts")

print(cdc_inpatient_occupied_beds_plot)

```

We will get a summmary of the inpatient occupied beds data and calcualte the standard deviation.

```{r}
summary(cdc_ga_mandatory_refined$`Weekly Average Inpatient Beds Occupied`)
#We will calculate the standard deviation 
sd(cdc_ga_mandatory_refined$`Weekly Average Inpatient Beds Occupied`)
```

```{r}
#We are looking at the distribution of the occupied ICU beds  
cdc_icu_occupied_beds_plot<- ggplot(cdc_ga_mandatory_refined, aes(x=`Weekly Average ICU Beds Occupied`)) + geom_histogram(bins=10,fill= "red", color = "black") + labs(title = "Distribution of the weekly Average Occupied ICU Beds", x = "Weekly Occupied ICU Beds", y = "Week counts")

print(cdc_icu_occupied_beds_plot)

```

We will get a summmary of the occupied ICU beds data and calcualte the standard deviation.

```{r}
summary(cdc_ga_mandatory_refined$`Weekly Average ICU Beds Occupied`)
#We will calculate the standard deviation 
sd(cdc_ga_mandatory_refined$`Weekly Average ICU Beds Occupied`)
```

We can look at the occupancy of the inpatient hosptial beds by week for the period evaluated, we will generate a line plot:

```{r}
#We are looking at the distribution of the occupied inptient beds over time 
cdc_inpatient_beds_time_plot<- ggplot(cdc_ga_mandatory_refined, aes(x=`Week Ending Date`, y=`Weekly Average Inpatient Beds Occupied`)) + geom_line(color = "black") + labs(title = "Average Occupancy of Inpatient Beds over time", x = "Week Evaluated", y = "Weekly Occupied Inpatient Beds")

print(cdc_inpatient_beds_time_plot)

```

We will provide a summary of the number of hospitals reporting COVID-19 and influenza respectively without plotting a graph.

We will get a summmary of the number of hospital reporting Adult COVID-19 Admissions and calcualte the standard deviation.

```{r}
summary(cdc_ga_mandatory_refined$`Number Hospitals Reporting Adult COVID-19 Admissions`)
#We will calculate the standard deviation 
sd(cdc_ga_mandatory_refined$`Number Hospitals Reporting Adult COVID-19 Admissions`)
```

We will get a summmary of the number of hospital reporting Influenza Admissions and calcualte the standard deviation.

```{r}
summary(cdc_ga_mandatory_refined$`Number Hospitals Reporting Influenza Admissions`)
#We will calculate the standard deviation 
sd(cdc_ga_mandatory_refined$`Number Hospitals Reporting Influenza Admissions`)
```

We see very similar values for influenza and COVID-19, although we realize that the 0 values in the influenza cases might be an artifact carried by the original creators from the NA values. We will create a new variable looking at the number of hospitals reporting influenza cases without these entries.

```{r}
#We are using a loop function to first select for rows where there are no NA values, this is based on using one of the columsn that we previously saw had an NA value. We then select the rows to only keep the influenza data

filtered_infuenza_cases<- cdc_ga_mandatory_refined |> filter(!is.na(`Weekly Total Influenza Admissions`)) |> 
  select(`Week Ending Date`, `Number Hospitals Reporting Influenza Admissions`, `Weekly Total Influenza Admissions`,`Weekly Average Hospitalized Influenza ICU Patients`)

```

We can now run the previous summary of the influenza reported cases by hospitals again and comapre results

```{r}
summary(filtered_infuenza_cases$`Number Hospitals Reporting Influenza Admissions`)
#We will calculate the standard deviation 
sd(filtered_infuenza_cases$`Number Hospitals Reporting Influenza Admissions`)
```

We see that the values did change, with the standard deviation decreasing by around 7, but it perhaps did not decrease by as much as expected because the minimum value is now 1 instead of 0.
